<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>icon-archaeology</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: Geneva, "Lucida Grande", system-ui, sans-serif;
      background: #c0c0c0;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(to bottom, #fff, #ddd);
      border: 2px solid #000;
      padding: 16px 20px;
      margin-bottom: 20px;
      box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
    }

    h1 {
      font-size: 18px;
      margin: 0 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 img { width: 32px; height: 32px; image-rendering: pixelated; }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    input, select, button {
      font-family: inherit;
      font-size: 12px;
      padding: 4px 8px;
      border: 2px solid #888;
      background: #fff;
    }

    input:focus, select:focus { outline: none; border-color: #000; }

    button {
      background: linear-gradient(to bottom, #fff, #ddd);
      cursor: pointer;
    }
    button:hover { background: linear-gradient(to bottom, #fff, #eee); }
    button:active { background: #ccc; }

    #search { width: 200px; }

    .stats {
      margin-left: auto;
      font-size: 11px;
      color: #666;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
    }

    .icon {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px;
      background: #fff;
      border: 2px solid #999;
      cursor: pointer;
      transition: border-color 0.1s;
    }

    .icon:hover {
      border-color: #000;
      background: #f8f8ff;
    }

    .icon.selected {
      border-color: #0066cc;
      background: #e8f0ff;
    }

    .icon img {
      width: 32px;
      height: 32px;
      image-rendering: pixelated;
    }

    .icon span {
      font-size: 8px;
      text-align: center;
      margin-top: 4px;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .loading, .empty {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .empty { font-style: italic; padding: 60px; }

    #preview {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #fff;
      border: 2px solid #000;
      padding: 16px;
      box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
      display: none;
      max-width: 300px;
    }

    #preview.visible { display: block; }

    #preview img {
      width: 64px;
      height: 64px;
      image-rendering: pixelated;
      display: block;
      margin: 0 auto 12px;
    }

    #preview .name {
      font-weight: bold;
      font-size: 12px;
      margin-bottom: 4px;
      word-break: break-all;
    }

    #preview .collection {
      font-size: 10px;
      color: #666;
      margin-bottom: 8px;
    }

    #preview .path {
      font-size: 9px;
      color: #999;
      font-family: Monaco, monospace;
      background: #f5f5f5;
      padding: 4px;
      word-break: break-all;
    }

    #preview button {
      margin-top: 8px;
      width: 100%;
    }
  </style>
</head>
<body>
  <header>
    <h1>
      <img src="" id="header-icon" alt="">
      icon-archaeology
    </h1>
    <div class="controls">
      <input type="text" id="search" placeholder="Search icons...">
      <select id="collection">
        <option value="">All collections</option>
      </select>
      <select id="variant">
        <option value="transparent">Transparent</option>
        <option value="opaque">Opaque (white bg)</option>
      </select>
      <div class="stats">
        <span id="count">0</span> icons
      </div>
    </div>
  </header>

  <div class="grid" id="grid">
    <div class="loading">Loading icons...</div>
  </div>

  <div id="preview">
    <img src="" alt="">
    <div class="name"></div>
    <div class="collection"></div>
    <div class="path"></div>
    <button id="copy-btn">Copy path</button>
  </div>

  <script>
    const ICONS_BASE = '../../Inspo space/public/icons';
    let allIcons = [];
    let collections = new Set();
    let selectedIcon = null;

    // Parse icon filename into parts
    function parseIconName(filename) {
      const name = filename.replace('.png', '');
      const parts = name.split('--');
      return {
        collection: parts[0] || 'unknown',
        name: parts.slice(1).join('--') || parts[0],
        filename
      };
    }

    // Build icon card using safe DOM methods
    function createIconCard(icon, variant) {
      const folder = variant === 'transparent' ? 'extracted-transparent' : 'extracted';
      const path = ICONS_BASE + '/' + folder + '/' + icon.filename;

      const div = document.createElement('div');
      div.className = 'icon';

      const img = document.createElement('img');
      img.src = path;
      img.alt = icon.name;
      img.loading = 'lazy';

      const span = document.createElement('span');
      span.textContent = icon.name;
      span.title = icon.name;

      div.appendChild(img);
      div.appendChild(span);

      div.onclick = () => selectIcon(icon, path, div);
      return div;
    }

    // Select icon for preview
    function selectIcon(icon, path, element) {
      document.querySelectorAll('.icon.selected').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');

      selectedIcon = { icon, path };

      const preview = document.getElementById('preview');
      preview.querySelector('img').src = path;
      preview.querySelector('.name').textContent = icon.name;
      preview.querySelector('.collection').textContent = icon.collection;
      preview.querySelector('.path').textContent = path.split('public/')[1];
      preview.classList.add('visible');
    }

    // Copy path to clipboard
    function copyPath() {
      if (!selectedIcon) return;
      const relativePath = '/icons/' + selectedIcon.path.split('/icons/')[1];
      navigator.clipboard.writeText(relativePath);
      alert('Copied: ' + relativePath);
    }

    // Filter and render icons
    function render() {
      const search = document.getElementById('search').value.toLowerCase();
      const collection = document.getElementById('collection').value;
      const variant = document.getElementById('variant').value;

      const filtered = allIcons.filter(icon => {
        if (collection && icon.collection !== collection) return false;
        if (search && !icon.name.includes(search) && !icon.collection.includes(search)) return false;
        return true;
      });

      const grid = document.getElementById('grid');
      grid.replaceChildren();

      if (filtered.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.textContent = 'No icons match your search';
        grid.appendChild(empty);
      } else {
        // Limit initial render for performance
        const toRender = filtered.slice(0, 500);
        toRender.forEach(icon => {
          grid.appendChild(createIconCard(icon, variant));
        });

        if (filtered.length > 500) {
          const more = document.createElement('div');
          more.className = 'loading';
          more.textContent = 'Showing 500 of ' + filtered.length + ' icons. Refine your search to see more.';
          grid.appendChild(more);
        }
      }

      document.getElementById('count').textContent = filtered.length.toLocaleString();
    }

    // Populate collection dropdown using safe DOM methods
    function populateCollections() {
      const select = document.getElementById('collection');
      select.replaceChildren();

      const defaultOpt = document.createElement('option');
      defaultOpt.value = '';
      defaultOpt.textContent = 'All collections';
      select.appendChild(defaultOpt);

      [...collections].sort().forEach(c => {
        const count = allIcons.filter(i => i.collection === c).length;
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c + ' (' + count + ')';
        select.appendChild(opt);
      });
    }

    // Fetch icon list
    async function loadIcons() {
      const variant = document.getElementById('variant').value;
      const folder = variant === 'transparent' ? 'extracted-transparent' : 'extracted';

      try {
        // Try to fetch directory listing (works with some servers)
        const response = await fetch(ICONS_BASE + '/' + folder + '/');
        const text = await response.text();

        // Parse HTML directory listing
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');
        const links = doc.querySelectorAll('a');

        allIcons = [];
        collections.clear();

        links.forEach(link => {
          const href = link.getAttribute('href');
          if (href && href.endsWith('.png')) {
            const filename = decodeURIComponent(href.split('/').pop());
            const icon = parseIconName(filename);
            allIcons.push(icon);
            collections.add(icon.collection);
          }
        });

        populateCollections();

        // Set random header icon
        if (allIcons.length > 0) {
          const randomIcon = allIcons[Math.floor(Math.random() * allIcons.length)];
          document.getElementById('header-icon').src =
            ICONS_BASE + '/' + folder + '/' + randomIcon.filename;
        }

        render();

      } catch (e) {
        const grid = document.getElementById('grid');
        grid.replaceChildren();

        const empty = document.createElement('div');
        empty.className = 'empty';

        const p1 = document.createElement('p');
        p1.textContent = 'Could not load icons automatically.';

        const p2 = document.createElement('p');
        p2.style.fontSize = '11px';
        p2.style.marginTop = '12px';
        p2.textContent = 'To use this gallery, serve it with a web server: ';

        const code = document.createElement('code');
        code.style.background = '#f5f5f5';
        code.style.padding = '2px 6px';
        code.textContent = 'python -m http.server 8000';
        p2.appendChild(code);

        empty.appendChild(p1);
        empty.appendChild(p2);
        grid.appendChild(empty);
      }
    }

    // Event listeners
    document.getElementById('search').addEventListener('input', render);
    document.getElementById('collection').addEventListener('change', render);
    document.getElementById('variant').addEventListener('change', loadIcons);
    document.getElementById('copy-btn').addEventListener('click', copyPath);

    // Initial load
    loadIcons();
  </script>
</body>
</html>
